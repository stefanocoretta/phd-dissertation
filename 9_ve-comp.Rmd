
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = here::here())
library(tidyverse)
theme_set(theme_minimal())
library(brms)
library(tidybayes)
library(coretta2018itapol)
data("token_measures")
library(coretta2019eng)
data("eng_durations")
```

\chapter{Cross-linguistic comparison of the voicing effect in English, Italian, and Polish}

```{r merge-data}
ita_pol <- token_measures %>%
  select(language, speaker, word, c2_phonation, v1_duration, c2_clos_duration, speech_rate) %>%
  rename(voicing = "c2_phonation")

eng <- eng_durations %>%
  filter(num_syl == "di") %>%
  mutate(language = "English") %>%
  select(language, speaker, word, voicing, v1_duration, c2_clos_duration, speech_rate) %>%
  mutate_if(is.factor, as.character)

enitpl <- bind_rows(eng, ita_pol) %>%
  mutate(
    language = factor(language, levels = c("English", "Italian", "Polish")),
    voicing = factor(voicing, levels = c("voiceless", "voiced")),
    speech_rate_c = scale(speech_rate),
    vc_ratio = v1_duration / c2_clos_duration
  ) %>%
  mutate_if(is.character, as.factor) %>%
  na.omit()
```

A Bayesian analysis was run to statistically test differences in the voicing effect in disyllabic (CV́CV) words of English (Study II), Italian, and Polish (Study I).
Note that the experimental design differs between the two studies (see \Cref{s:studies}), so results should be interpreted with caution.
The following graph shows violin and box plots of the raw vowel duration data, by voicing of C2 and language.
English and Italian have similar vowel durations and a similar effect of voicing, while Polish has generally shorter vowels and a somewhat smaller effect.

```{r v1-dur, include=TRUE}
enitpl %>%
  ggplot(aes(voicing, v1_duration)) +
  geom_violin() +
  geom_boxplot(width = 0.3) +
  geom_point(alpha = 0.1, position = position_jitter(seed = 3241)) +
  facet_grid(~ language) +
  labs(
    x = "Consonant voicing", y = "Vowel duration"
  )
```

A Bayesian mixed-effects regression was fitted to V1 duration with brms \citep{burkner2017, burkner2018} in R \citep{r-core-team2019}.

```{r brm-1}
priors <- c(
  prior(normal(145, 30), class = Intercept),
  prior(normal(0, 50), class = b, coef = languageItalian),
  prior(normal(0, 50), class = b, coef = languagePolish),
  prior(normal(25, 10), class = b, coef = voicingvoiced),
  prior(normal(0, 10), class = b, coef = languageItalian:voicingvoiced),
  prior(normal(0, 10), class = b, coef = languagePolish:voicingvoiced),
  prior(normal(-25, 10), class = b, coef = speech_rate_c),
  prior(cauchy(0, 25), class = sd),
  prior(lkj(2), class = cor),
  prior(cauchy(0, 25), class = sigma)
)

brm_1 <- brm(
  v1_duration ~
    language +
    voicing +
    language:voicing +
    speech_rate_c +
    (voicing | speaker) +
    (voicing | word),
  data = enitpl,
  family = gaussian(),
  prior = priors,
  file = "cache/ve_comp",
  cores = 4,
  control = list(adapt_delta = 0.999, max_treedepth = 15),
  seed = 1432
)
```

```{r brm-1-summary}
summary(brm_1)
```

```{r brm-1-draws}
brm_1_draws <- brm_1 %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  filter(.variable != "b_Intercept")
```

```{r brm-1-intervals, include=TRUE}
brm_1_draws %>%
  ungroup() %>%
  mutate(.variable = factor(.variable, levels = c("b_voicingvoiced", "b_languageItalian", "b_languagePolish", "b_languageItalian:voicingvoiced", "b_languagePolish:voicingvoiced", "b_speech_rate_c")[6:1])) %>%
  ggplot(aes(.value, .variable)) +
  geom_vline(xintercept = 0) +
  geom_halfeyeh(fill = "#9ecae1", .width = c(0.66, 0.98), fatten_point = 1, scale = "width", relative_scale = 0.7) +
  stat_intervalh(position = position_nudge(y = -0.2), size = 2) +
  scale_color_brewer() +
  scale_x_continuous(breaks = seq(-50, 50, 10)) +
  scale_y_discrete(labels = c("Speech rate (ctrd)", "Polish × voiced", "Italian × voiced", "Polish", "Italian", "C2 voicing = voiced")) +
  labs(
    x = "Difference in vowel duration (ms)",
    y = element_blank()
  ) +
  theme(panel.grid.minor = element_blank())
```
